<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Mini Google Docs</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="header">
      <div class="doc-title" contenteditable="true" spellcheck="false">
        Mon Document
      </div>
      <div class="users" id="users-list">
        <!-- Avatars ou initiales des utilisateurs -->
      </div>
    </header>
    <main class="main-container">
      <section class="editor-section">
        <div class="toolbar">
          <button type="button" class="tool-btn" data-cmd="bold" title="Gras">
            <b>B</b>
          </button>
          <button
            type="button"
            class="tool-btn"
            data-cmd="italic"
            title="Italique"
          >
            <i>I</i>
          </button>
          <button
            type="button"
            class="tool-btn"
            data-cmd="underline"
            title="Souligné"
          >
            <u>U</u>
          </button>
          <input
            type="number"
            class="tool-input"
            id="font-size-input"
            title="Taille du texte (px)"
            min="8"
            max="72"
            step="1"
            value="16"
            style="width: 60px; margin-left: 8px"
          />
          <span style="font-size: 0.95em; color: #888; margin-left: 2px"
            >px</span
          >
        </div>
        <textarea
          id="editor"
          class="editor a4-page"
          contenteditable="true"
          spellcheck="true"
          autocomplete="off"
          aria-label="Zone d'édition"
        ></textarea>
      </section>
      <aside class="history-section" id="history">
        <!-- Historique des modifications -->
      </aside>
    </main>
    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js"></script>
    <script>
      // Barre d'outils : commandes de mise en forme
      document.querySelectorAll(".tool-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.execCommand(btn.dataset.cmd, false, null);
        });
      });
      // Taille de police personnalisée
      const fontSizeInput = document.getElementById("font-size-input");
      fontSizeInput.addEventListener("change", function () {
        const size = this.value;
        const sel = window.getSelection();
        if (sel && sel.rangeCount > 0) {
          const range = sel.getRangeAt(0);
          if (!sel.isCollapsed) {
            // Appliquer à la sélection (comme avant)
            document.execCommand("styleWithCSS", true);
            document.execCommand("fontSize", false, 7);
            const editor = document.getElementById("editor");
            const fonts = editor.querySelectorAll('font[size="7"]');
            fonts.forEach((font) => {
              if (range.intersectsNode(font)) {
                const span = document.createElement("span");
                span.style.fontSize = size + "px";
                span.innerHTML = font.innerHTML;
                font.parentNode.replaceChild(span, font);
              }
            });
          } else {
            // Rien n'est sélectionné : insérer un span vide à la position du curseur et placer le caret dedans
            const span = document.createElement("span");
            span.style.fontSize = size + "px";
            span.appendChild(document.createTextNode("\u200B"));
            range.insertNode(span);
            // Placer le caret à l'intérieur du span
            range.setStart(span.firstChild, 1);
            range.setEnd(span.firstChild, 1);
            sel.removeAllRanges();
            sel.addRange(range);
          }
        }
      });
      // Valeur de base sur tout le texte
      document.getElementById("editor").style.fontSize =
        fontSizeInput.value + "px";
    </script>
  </body>
</html>
